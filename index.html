<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>비휴전 냉각기 시뮬레이션 (도면 기반 v6.2 모바일)</title>
  <style>
    :root{
      --bg:#0b0f14;
      --text:#e6edf6;
      --muted:#a7b4c6;

      --cold: rgba(99,179,255,.78);
      --hot: rgba(255,209,102,.78);
      --drain: rgba(110,231,183,.78);

      --shadow: 0 10px 30px rgba(0,0,0,.45);
      --r:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial;
      color:var(--text);
      background:
        radial-gradient(1100px 700px at 20% 10%, rgba(99,179,255,.10), transparent 55%),
        radial-gradient(1000px 700px at 85% 15%, rgba(110,231,183,.08), transparent 60%),
        linear-gradient(180deg, var(--bg), #070a0f 70%, #05070b);
    }
    .wrap{max-width:1200px;margin:22px auto;padding:0 16px 26px}
    header{display:flex;gap:14px;align-items:flex-start;justify-content:space-between;margin-bottom:12px}
    h1{margin:0;font-size:20px;letter-spacing:-.2px;font-weight:780}
    .sub{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.45;max-width:900px}
    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      color:var(--muted);font-size:12px;white-space:nowrap
    }
    .dot{width:8px;height:8px;border-radius:999px;background:var(--cold);box-shadow:0 0 0 4px rgba(99,179,255,.12)}
    .grid{display:grid;grid-template-columns:1.25fr .75fr;gap:14px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:14px 16px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: linear-gradient(180deg, rgba(15,23,36,.85), rgba(15,23,36,.35));
    }
    .hd .h{display:flex;flex-direction:column;gap:2px}
    .hd .h strong{font-size:14px;letter-spacing:-.2px}
    .hd .h span{font-size:12px;color:var(--muted)}
    .bd{padding:14px 16px}

    .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;align-items:center}
    button{
      appearance:none;cursor:pointer;user-select:none;
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.03));
      color:var(--text);
      padding:10px 12px;border-radius:12px;font-size:12.5px;
      transition:transform .08s ease,border-color .12s ease,opacity .12s ease;
    }
    button:hover{border-color: rgba(99,179,255,.35)}
    button:active{transform: translateY(1px)}
    button.primary{
      border-color: rgba(99,179,255,.35);
      background: linear-gradient(180deg, rgba(99,179,255,.22), rgba(99,179,255,.08));
    }
    button.ghost{background:transparent}
    button:disabled{opacity:.45;cursor:not-allowed}

    .pill{
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      color:var(--muted);
      font-size:12px;font-variant-numeric:tabular-nums;
    }
    .stepper{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .progress{
      height:8px;border-radius:999px;overflow:hidden;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.08);
      flex:1;min-width:180px;
    }
    .bar{height:100%;width:0%;background: rgba(99,179,255,.65);transition:width .25s ease}

    .bigTitle{margin:0;font-size:16px;letter-spacing:-.2px}
    .oneLine{margin:8px 0 0;color:var(--text);font-size:13.5px;line-height:1.55}
    .whatNow{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.18);
      color:var(--muted);
      font-size:12.5px;
      line-height:1.5;
    }
    .whatNow b{color:var(--text)}
    .miniList{margin:10px 0 0;padding:0;list-style:none;display:grid;gap:8px}
    .miniItem{
      padding:10px 12px;border-radius:14px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
      display:flex;gap:10px;align-items:flex-start;
      cursor:pointer;
      transition:border-color .12s ease, transform .08s ease, background-color .12s ease;
    }
    .miniItem:hover{border-color: rgba(99,179,255,.25)}
    .miniItem:active{transform: translateY(1px)}
    .miniNum{
      width:26px;height:26px;border-radius:10px;
      display:flex;align-items:center;justify-content:center;
      background: rgba(99,179,255,.14);
      border:1px solid rgba(99,179,255,.25);
      color: rgba(230,237,246,.95);
      font-size:12px;flex:0 0 auto;
      font-variant-numeric:tabular-nums;
    }
    .miniTxt{display:flex;flex-direction:column;gap:4px}
    .miniTxt strong{font-size:12.5px;color:rgba(230,237,246,.92)}
    .miniTxt span{font-size:12px;color:var(--muted);line-height:1.45}

    /* 현재 STEP 고정 하이라이트(약하게, 깜빡임 없음) */
    .miniItem.active{
      border-color: rgba(99,179,255,.22);
      background: rgba(99,179,255,.06);
      box-shadow: 0 0 0 1px rgba(99,179,255,.10) inset;
    }
    .miniItem.active .miniNum{
      border-color: rgba(99,179,255,.22);
      background: rgba(99,179,255,.16);
    }
    .miniItem.active .miniTxt strong{color: rgba(230,237,246,.96);}
    .miniItem.active .miniTxt span{color: rgba(167,180,198,.95);}

    .legend{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;color:var(--muted);font-size:12px}
    .lg{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.08);background: rgba(0,0,0,.16)}
    .sw{width:12px;height:12px;border-radius:4px;background: var(--cold)}
    .sw.hot{background: var(--hot)}
    .sw.drain{background: var(--drain)}
    .sw.idle{background: rgba(255,255,255,.35)}

    svg{width:100%;height:auto;display:block}
    .frame{fill: rgba(0,0,0,.16);stroke: rgba(255,255,255,.08);stroke-width:1.2}
    .label{fill: rgba(230,237,246,.93);font-size:12px;letter-spacing:-.2px}
    .sublabel{fill: rgba(167,180,198,.9);font-size:11px}
    .box{fill: rgba(16,24,38,.78);stroke: rgba(255,255,255,.12);stroke-width:1.2}
    .box2{fill: rgba(16,24,38,.55);stroke: rgba(255,255,255,.10);stroke-width:1.1}
    .pipe{fill:none;stroke: rgba(255,255,255,.18);stroke-width:6.5;stroke-linecap:round;stroke-linejoin:round}
    .pipe.thin{stroke-width:5.4}
    .pipe.cold{stroke: var(--cold)}
    .pipe.hot{stroke: var(--hot)}
    .pipe.drain{stroke: var(--drain)}
    .pipe.dash{stroke-dasharray: 10 12; animation: moveDash 1.25s linear infinite}
    @keyframes moveDash{from{stroke-dashoffset:0}to{stroke-dashoffset:-120}}
    .node{fill: rgba(255,255,255,.16);stroke: rgba(255,255,255,.18);stroke-width:1}
    .valve{fill: rgba(0,0,0,.22);stroke: rgba(255,255,255,.18);stroke-width:1}
    .gateLine{stroke: rgba(255,255,255,.18);stroke-width:1.2}
    .gateOn{stroke: rgba(110,231,183,.85)}
    .flowDot{opacity:0}
    .flowing .flowDot{opacity:1}
    .flowDot.cold{filter: drop-shadow(0 0 6px rgba(99,179,255,.35))}
    .flowDot.hot{filter: drop-shadow(0 0 6px rgba(255,209,102,.35))}
    .flowDot.drain{filter: drop-shadow(0 0 6px rgba(110,231,183,.35))}

    /* HX internal coil paths */
    .coil{
      fill:none;
      stroke: rgba(255,255,255,.18);
      stroke-width:5.2;
      stroke-linecap:round;
      stroke-linejoin:round;
      opacity:.30;
    }
    .coilFlow{
      stroke: rgba(255,209,102,.88);
      opacity:.98;
      stroke-dasharray: 10 14;
      animation: coilDash 0.85s linear infinite;
      filter: drop-shadow(0 0 10px rgba(255,209,102,.28));
    }
    @keyframes coilDash{from{stroke-dashoffset:0}to{stroke-dashoffset:-140}}

    /* sump water level */
    .water{fill: rgba(110,231,183,.20);stroke: rgba(110,231,183,.25);stroke-width:1;opacity:0;}
    .waterOn{opacity:1}
    .waterSurface{stroke: rgba(110,231,183,.65);stroke-width:2;opacity:0;}
    .waterSurfaceOn{opacity:.95;filter: drop-shadow(0 0 8px rgba(110,231,183,.25));}

    /* Tooltip */
    .tooltip{
      position:fixed;z-index:40;
      min-width:240px;max-width:360px;
      padding:12px 12px;border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(10,14,20,.92);
      box-shadow: 0 18px 40px rgba(0,0,0,.55);
      display:none;
      backdrop-filter: blur(10px);
    }
    .tooltip h3{margin:0 0 6px;font-size:13px;letter-spacing:-.2px}
    .tooltip p{margin:0;color:var(--muted);font-size:12.5px;line-height:1.5}
    .tooltip .meta{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;color:rgba(167,180,198,.85);font-size:11.5px}
    .tooltip .chip{padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.10);background: rgba(255,255,255,.05)}

    /* Step emphasis effects */
    @keyframes glowCold {0%,100%{filter:none}50%{filter:drop-shadow(0 0 12px rgba(99,179,255,.42))}}
    @keyframes glowHot  {0%,100%{filter:none}50%{filter:drop-shadow(0 0 12px rgba(255,209,102,.42))}}
    @keyframes glowDrain{0%,100%{filter:none}50%{filter:drop-shadow(0 0 12px rgba(110,231,183,.42))}}
    @keyframes heatPulse {0%,100%{filter:drop-shadow(0 0 6px rgba(255,209,102,.18))}50%{filter:drop-shadow(0 0 16px rgba(255,209,102,.45))}}
    @keyframes fillWobble {0%,100%{opacity:.55}50%{opacity:.88}}

    .glow-cold{ animation: glowCold 1.15s ease-in-out infinite; }
    .glow-hot{  animation: glowHot  1.15s ease-in-out infinite; }
    .glow-drain{animation: glowDrain 1.15s ease-in-out infinite; }

    .tank-cold-active{ fill: rgba(99,179,255,.12) !important; animation: fillWobble 1.1s ease-in-out infinite; }
    .tank-hot-active { fill: rgba(255,209,102,.12) !important; animation: fillWobble 1.1s ease-in-out infinite; }

    .hx-heat{ animation: heatPulse 1.0s ease-in-out infinite; }
    .pump-run{ animation: heatPulse 1.05s ease-in-out infinite; }

    .overview-lite .frame{
      stroke: rgba(99,179,255,.18);
      filter: drop-shadow(0 0 14px rgba(99,179,255,.10));
    }

    /* STEP Dimming */
    .dimOn svg .dimTarget{
      opacity:.22;
      transition: opacity .18s ease, filter .18s ease;
    }
    .dimOn svg .dimTarget.focus{
      opacity:1;
      filter: drop-shadow(0 0 10px rgba(230,237,246,.06));
    }
    .dimOn svg text.dimTarget{opacity:.18;}
    .dimOn svg text.dimTarget.focus{opacity:.92;filter:none;}

    /* ===== v6.2 Mobile: 레이아웃/컨트롤/툴팁/터치 ===== */
    .hotspot{cursor:pointer}
    @media (max-width: 820px){
      .wrap{margin:14px auto;padding:0 12px 18px}
      header{flex-direction:column;align-items:flex-start}
      .badge{align-self:flex-start}

      .grid{grid-template-columns:1fr}
      .hd{flex-direction:column;align-items:stretch;gap:10px}

      /* 컨트롤을 하단에 sticky로: 한 손 조작 */
      .controls{
        position: sticky;
        bottom: 10px;
        z-index: 20;
        padding:10px;
        border-radius: 16px;
        background: rgba(10,14,20,.75);
        border:1px solid rgba(255,255,255,.10);
        backdrop-filter: blur(10px);
        box-shadow: 0 14px 40px rgba(0,0,0,.55);
        justify-content:space-between;
      }
      .stepper{width:100%;min-width:0}
      .stepper .progress{min-width:120px}
      button{flex:1;min-width:0;padding:12px 10px}
      button.ghost{flex:0.9}

      /* 작은 점/밸브 터치 체감 개선(시각적 약간 확대) */
      svg .node, svg .valve{
        transform-box: fill-box;
        transform-origin:center;
        transform: scale(1.25);
      }

      /* 툴팁을 bottom-sheet로 */
      .tooltip{
        left: 12px !important;
        right: 12px !important;
        top: auto !important;
        bottom: 12px !important;
        width: auto !important;
        max-width: none !important;
        display:none;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>비휴전 냉각기 시뮬레이션 (특허 도면 배치 기반 v6.2)</h1>
        <p class="sub">
          비상 상황에서도 <b>냉각을 멈추지 않기</b> 위해, 상수도(30) 냉수를 임시 헤더(110)에 넣고(111/115),
          열교환기(20)로 보내 냉각한 뒤(112→21), 데워진 물을 다시 받아(22→114) 배수(113/116→150→41)하는 흐름을 클릭으로 학습합니다.
        </p>
      </div>
      <div class="badge"><span class="dot"></span>등록특허 10-2350109 기반</div>
    </header>

    <div class="grid">
      <section class="card">
        <div class="hd">
          <div class="h">
            <strong>도면 스타일 구성도(도 1 배치 근사)</strong>
            <span>요소를 클릭/터치하면 쉬운 설명이 뜹니다(단계 전환 아님)</span>
          </div>
          <div class="controls">
            <div class="stepper" style="min-width:360px;max-width:520px;width:100%">
              <span class="pill" id="stepPill">STEP 1 / 7</span>
              <div class="progress"><div class="bar" id="bar"></div></div>
              <span class="pill" id="modePill">정지</span>
            </div>
            <button class="ghost" id="prevBtn">이전</button>
            <button class="primary" id="nextBtn">다음</button>
            <button id="playBtn">자동재생</button>
            <button class="ghost" id="resetBtn">처음</button>
          </div>
        </div>

        <div class="bd">
          <svg viewBox="0 0 980 560" role="img" aria-label="비휴전 냉각장치 구성도"
               style="touch-action: manipulation;">
            <rect class="frame" x="10" y="10" width="960" height="540" rx="18"></rect>

            <text class="sublabel" x="28" y="38">좌측(상수도/임시헤더/집수정) · 우측(변압기 3대 + 열교환기)</text>

            <g id="room" class="hotspot" data-tip="변압기실(10)"
               data-desc="변압기(11)와 열교환기(20)가 있는 공간입니다. 비휴전 냉각장치(100)는 이 공간에서 임시로 연결됩니다."
               data-meta="10, 설치 공간, 비상 연결">
              <rect class="box2" x="44" y="58" width="904" height="470" rx="16"></rect>
              <text class="sublabel" x="62" y="84">10</text>
            </g>

            <g id="tap" class="hotspot" data-tip="상수도(30) / 급수구(31)"
               data-desc="비상 운전 시 ‘냉각탑 대신’ 쓰는 냉수 공급원입니다."
               data-meta="30,31, 냉수 공급">
              <rect class="box2" x="70" y="110" width="150" height="62" rx="14"></rect>
              <text class="label" x="86" y="137">상수도(30)</text>
              <text class="sublabel" x="86" y="157">급수구(31)</text>
              <circle class="node" id="n31" cx="220" cy="141" r="7"></circle>
            </g>

            <g id="header" class="hotspot" data-tip="임시 헤더(110)"
               data-desc="냉수 저장부(110a)·온수 저장부(110b) 2칸으로 나뉘며, 공급/환수 포트와 입수/배수구, 수압조절밸브를 갖습니다."
               data-meta="110,110a,110b, 111~116, 117">
              <rect class="box" x="250" y="150" width="170" height="290" rx="18"></rect>
              <text class="label" x="268" y="178">임시 헤더(110)</text>

              <rect id="tankCold" class="box2 hotspot" x="268" y="194" width="134" height="102" rx="14"
                    data-tip="냉수 저장부(110a)"
                    data-desc="상수도 냉수가 먼저 들어와 모이는 칸입니다. 여기 물이 공급 포트(112)를 통해 열교환기로 나갑니다."
                    data-meta="110a, 공급 시작점"></rect>
              <text class="sublabel" x="278" y="222">냉수 저장부</text>
              <text class="sublabel" x="278" y="240">110a</text>

              <rect id="tankHot" class="box2 hotspot" x="268" y="312" width="134" height="112" rx="14"
                    data-tip="온수 저장부(110b)"
                    data-desc="열교환기를 거친 ‘따뜻해진 물’이 다시 들어오는 칸입니다. 이후 배수구(113)로 빠집니다."
                    data-meta="110b, 환수/배수"></rect>
              <text class="sublabel" x="278" y="340">온수 저장부</text>
              <text class="sublabel" x="278" y="358">110b</text>

              <g class="hotspot" data-tip="헤더 입수구(111) + 수압조절밸브(115)"
                 data-desc="상수도에서 들어온 냉수가 이곳을 통해 들어옵니다. 밸브(115)로 압력/유량을 조절합니다."
                 data-meta="111,115, 유입 조절">
                <circle class="node" id="n111" cx="250" cy="214" r="7"></circle>
                <rect class="valve" id="v115" x="230" y="202" width="16" height="24" rx="5"></rect>
                <text class="sublabel" x="208" y="220">111</text>
                <text class="sublabel" x="208" y="236">115</text>
              </g>

              <g class="hotspot" data-tip="헤더 배수구(113) + 수압조절밸브(116)"
                 data-desc="온수 저장부의 물이 이곳으로 빠집니다. 밸브(116)로 배출 압력/유량을 맞춥니다."
                 data-meta="113,116, 배수 조절">
                <circle class="node" id="n113" cx="250" cy="404" r="7"></circle>
                <rect class="valve" id="v116" x="230" y="392" width="16" height="24" rx="5"></rect>
                <text class="sublabel" x="208" y="410">113</text>
                <text class="sublabel" x="208" y="426">116</text>
              </g>

              <g id="ports112" class="hotspot" data-tip="공급 포트(112)"
                 data-desc="냉수 저장부의 물이 열교환기(20)로 나가는 출구입니다(3대 변압기 기준 3개)."
                 data-meta="112, 냉수 출구, 3라인">
                <circle class="node" id="n112a" cx="420" cy="230" r="6.5"></circle>
                <circle class="node" id="n112b" cx="420" cy="258" r="6.5"></circle>
                <circle class="node" id="n112c" cx="420" cy="286" r="6.5"></circle>
                <text class="sublabel" x="432" y="234">112</text>
              </g>

              <g id="ports114" class="hotspot" data-tip="환수 포트(114)"
                 data-desc="열교환기를 거친 따뜻한 물이 헤더(온수 저장부)로 돌아오는 입구입니다."
                 data-meta="114, 온수 입구, 3라인">
                <circle class="node" id="n114a" cx="420" cy="352" r="6.5"></circle>
                <circle class="node" id="n114b" cx="420" cy="380" r="6.5"></circle>
                <circle class="node" id="n114c" cx="420" cy="408" r="6.5"></circle>
                <text class="sublabel" x="432" y="356">114</text>
              </g>

              <g id="gate" class="hotspot" data-tip="게이트 밸브(117)"
                 data-desc="운전 중에는 ‘닫아두고’, 운전이 끝나면 ‘열어’ 잔류수를 배수 쪽으로 정리합니다."
                 data-meta="117, 운전중 폐쇄, 종료 후 개방">
                <line class="gateLine" x1="330" y1="296" x2="330" y2="312"></line>
                <line class="gateLine" x1="315" y1="304" x2="345" y2="304"></line>
                <line class="gateLine" id="gateState" x1="316" y1="296" x2="344" y2="312"></line>
                <text class="sublabel" x="350" y="308">117</text>
              </g>
            </g>

            <g id="pumpRoom" class="hotspot" data-tip="지하 펌프실(40) / 집수정(41) / 배수펌프(42)"
               data-desc="배수관(150)으로 온수가 모이는 곳(집수정)과, 밖으로 퍼내는 펌프입니다."
               data-meta="40,41,42, 배수 처리">
              <rect class="box2" x="70" y="420" width="150" height="88" rx="14"></rect>
              <text class="sublabel" x="86" y="446">40</text>

              <rect id="sump41Body" class="box" x="86" y="454" width="68" height="40" rx="12"></rect>
              <text class="sublabel" x="98" y="478">41</text>

              <clipPath id="clipSump41">
                <rect x="86" y="454" width="68" height="40" rx="12"></rect>
              </clipPath>
              <rect id="sumpWater" class="water" x="86" y="494" width="68" height="0" rx="12" clip-path="url(#clipSump41)"></rect>
              <line id="sumpSurface" class="waterSurface" x1="90" y1="494" x2="150" y2="494" clip-path="url(#clipSump41)"></line>

              <rect id="pump42" class="box" x="158" y="454" width="46" height="40" rx="12"></rect>
              <text class="sublabel" x="170" y="478">42</text>

              <circle class="node" id="n41in" cx="220" cy="474" r="7"></circle>
            </g>

            <g id="bank" class="hotspot" data-tip="변압기(11) + 열교환기(20)"
               data-desc="냉수(21)가 들어와 열을 받아 따뜻해지고, 온수(22)로 나갑니다. 3대(예시)로 한 뱅크 구성 가능."
               data-meta="11,20,21,22, 3대 예시">

              <g transform="translate(540,120)">
                <rect class="box" x="0" y="0" width="350" height="110" rx="18"></rect>
                <text class="sublabel" x="18" y="26">20</text>
                <text class="sublabel" x="314" y="26">11</text>
                <rect class="box2" x="120" y="18" width="110" height="74" rx="14"></rect>
                <path id="coil1" class="coil" d="M140 32 H210 M140 46 H210 M140 60 H210 M140 74 H210 M140 88 H210"></path>
                <circle class="node" id="hx1in" cx="-10" cy="55" r="7"></circle>
                <circle class="node" id="hx1out" cx="360" cy="55" r="7"></circle>
                <text class="sublabel" x="6" y="60">21</text>
                <text class="sublabel" x="332" y="60">22</text>
              </g>

              <g transform="translate(540,250)">
                <rect class="box" x="0" y="0" width="350" height="110" rx="18"></rect>
                <text class="sublabel" x="18" y="26">20</text>
                <text class="sublabel" x="314" y="26">11</text>
                <rect class="box2" x="120" y="18" width="110" height="74" rx="14"></rect>
                <path id="coil2" class="coil" d="M140 32 H210 M140 46 H210 M140 60 H210 M140 74 H210 M140 88 H210"></path>
                <circle class="node" id="hx2in" cx="-10" cy="55" r="7"></circle>
                <circle class="node" id="hx2out" cx="360" cy="55" r="7"></circle>
                <text class="sublabel" x="6" y="60">21</text>
                <text class="sublabel" x="332" y="60">22</text>
              </g>

              <g transform="translate(540,380)">
                <rect class="box" x="0" y="0" width="350" height="110" rx="18"></rect>
                <text class="sublabel" x="18" y="26">20</text>
                <text class="sublabel" x="314" y="26">11</text>
                <rect class="box2" x="120" y="18" width="110" height="74" rx="14"></rect>
                <path id="coil3" class="coil" d="M140 32 H210 M140 46 H210 M140 60 H210 M140 74 H210 M140 88 H210"></path>
                <circle class="node" id="hx3in" cx="-10" cy="55" r="7"></circle>
                <circle class="node" id="hx3out" cx="360" cy="55" r="7"></circle>
                <text class="sublabel" x="6" y="60">21</text>
                <text class="sublabel" x="332" y="60">22</text>
              </g>
            </g>

            <path id="p120" class="pipe thin" d="M227 141 C235 141, 238 155, 238 214 C238 214, 238 214, 243 214"></path>
            <text class="sublabel" x="205" y="184">120</text>

            <path id="p130a" class="pipe" d="M427 230 C500 230, 520 175, 530 175"></path>
            <path id="p130b" class="pipe" d="M427 258 C505 258, 520 305, 530 305"></path>
            <path id="p130c" class="pipe" d="M427 286 C505 286, 520 435, 530 435"></path>
            <text class="sublabel" x="468" y="214">130</text>

            <path id="p140a" class="pipe" d="M900 175 C820 175, 720 175, 460 352"></path>
            <path id="p140b" class="pipe" d="M900 305 C820 305, 720 305, 460 380"></path>
            <path id="p140c" class="pipe" d="M900 435 C820 435, 720 435, 460 408"></path>
            <text class="sublabel" x="780" y="160">140</text>

            <path id="p150" class="pipe" d="M243 404 C180 404, 180 474, 213 474"></path>
            <text class="sublabel" x="150" y="420">150</text>

            <circle class="flowDot cold" id="d120" cx="235" cy="165" r="6"></circle>
            <circle class="flowDot cold" id="d130a" cx="490" cy="230" r="6"></circle>
            <circle class="flowDot cold" id="d130b" cx="500" cy="258" r="6"></circle>
            <circle class="flowDot cold" id="d130c" cx="505" cy="286" r="6"></circle>

            <circle class="flowDot hot" id="d140a" cx="760" cy="185" r="6"></circle>
            <circle class="flowDot hot" id="d140b" cx="760" cy="315" r="6"></circle>
            <circle class="flowDot hot" id="d140c" cx="760" cy="445" r="6"></circle>

            <circle class="flowDot drain" id="d150" cx="190" cy="450" r="6"></circle>
          </svg>

          <div class="legend">
            <span class="lg"><span class="sw"></span>냉수(공급)</span>
            <span class="lg"><span class="sw hot"></span>온수(환수)</span>
            <span class="lg"><span class="sw drain"></span>배수</span>
            <span class="lg"><span class="sw idle"></span>대기</span>
          </div>

          <div style="margin-top:10px;color:rgba(167,180,198,.85);font-size:12px;line-height:1.55">
            조작: <b>이전/다음</b> 단계, <b>자동재생</b>, 도면 요소 터치 시 쉬운 설명.
          </div>
        </div>
      </section>

      <aside class="card">
        <div class="hd">
          <div class="h">
            <strong>단계별로 ‘물의 길’만 따라가기</strong>
            <span>교육용 모드: 관련 없는 부분은 자동으로 흐려집니다</span>
          </div>
        </div>
        <div class="bd">
          <h2 class="bigTitle" id="stTitle">-</h2>
          <p class="oneLine" id="stOne">-</p>
          <div class="whatNow" id="stNow">-</div>
          <ul class="miniList" id="miniList"></ul>
        </div>
      </aside>
    </div>
  </div>

  <div class="tooltip" id="tip" aria-live="polite">
    <h3 id="tipTitle">-</h3>
    <p id="tipDesc">-</p>
    <div class="meta" id="tipMeta"></div>
  </div>

<script>
(() => {
  const $ = (s, el=document) => el.querySelector(s);
  const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));

  // 유로 기준(특허 설명): 30→120→111/115→110a→112→130→21→20→22→140→114→110b→113/116→150→41/42
  const steps = [
    { title:"STEP 1. 전체 개요 (도 1을 한 번 훑기)",
      one:"비상 상황에서, 냉각탑 대신 상수도 냉수를 써서 열교환기 순환을 유지합니다.",
      now:"<b>지금은:</b> 왼쪽은 ‘공급/헤더/배수’, 오른쪽은 ‘변압기 3대(예시)’입니다.",
      flow:{on:false,cold:false,hot:false,drain:false,gateOpen:false}
    },
    { title:"STEP 2. 유입: 상수도(30) → 120 → 입수구(111)",
      one:"냉수는 120을 타고 헤더(110)로 들어옵니다.",
      now:"<b>지금은:</b> 파란 라인 <b>120</b>만 따라가 보세요. (유입 조절은 115)",
      flow:{on:true,cold:["p120"],hot:false,drain:false,gateOpen:false}
    },
    { title:"STEP 3. 저장: 냉수 저장부(110a)에 먼저 모입니다",
      one:"들어온 냉수는 110a에 모였다가, 공급 포트(112)로 나갈 준비를 합니다.",
      now:"<b>지금은:</b> 110a(모이는 칸)만 기억하면 됩니다.",
      flow:{on:true,cold:["p120"],hot:false,drain:false,gateOpen:false}
    },
    { title:"STEP 4. 공급: 112 → 130 → 21 → 20",
      one:"110a의 냉수가 (예시) 3개 라인으로 열교환기(20)로 들어갑니다.",
      now:"<b>지금은:</b> 파란 라인 <b>130</b> = 헤더에서 열교환기로 가는 길입니다.",
      flow:{on:true,cold:["p130a","p130b","p130c"],hot:false,drain:false,gateOpen:false}
    },
    { title:"STEP 5. 열교환: 내부 코일(유로)에서 열을 주고받습니다",
      one:"냉수(21)가 열을 받고, 온수(22)로 나옵니다.",
      now:"<b>지금은:</b> 열교환기 안쪽(코일)만 노란색으로 ‘흐르게’ 보입니다.",
      flow:{on:true,cold:["p130a","p130b","p130c"],hot:["p140a","p140b","p140c"],drain:false,gateOpen:false}
    },
    { title:"STEP 6. 환수/저장: 140 → 114 → 온수 저장부(110b)",
      one:"따뜻해진 물은 140을 통해 헤더로 돌아와 110b에 모입니다.",
      now:"<b>지금은:</b> 노란 라인 <b>140</b>만 따라가고 110b(모이는 칸)를 확인하세요.",
      flow:{on:true,cold:false,hot:["p140a","p140b","p140c"],drain:false,gateOpen:false}
    },
    { title:"STEP 7. 배수/정리: 110b → 113/116 → 150 → 집수정(41)",
      one:"운전이 끝나면 물을 150으로 빼서 집수정으로 보낼 수 있습니다.",
      now:"<b>지금은:</b> 집수정(41) 수위가 ‘차오르는’ 것으로 배수를 직관적으로 보여줍니다.",
      flow:{on:true,cold:false,hot:false,drain:["p150"],gateOpen:true}
    }
  ];

  const stepPill = $("#stepPill");
  const modePill = $("#modePill");
  const bar = $("#bar");
  const prevBtn = $("#prevBtn");
  const nextBtn = $("#nextBtn");
  const playBtn = $("#playBtn");
  const resetBtn = $("#resetBtn");

  const stTitle = $("#stTitle");
  const stOne = $("#stOne");
  const stNow = $("#stNow");
  const miniList = $("#miniList");

  const svg = document.querySelector("svg");

  const p120 = $("#p120");
  const p130a = $("#p130a"), p130b = $("#p130b"), p130c = $("#p130c");
  const p140a = $("#p140a"), p140b = $("#p140b"), p140c = $("#p140c");
  const p150 = $("#p150");

  const gateState = $("#gateState");
  const v115 = $("#v115");
  const v116 = $("#v116");

  const tankCold = $("#tankCold");
  const tankHot = $("#tankHot");
  const pump42 = $("#pump42");

  const hxBoxes = Array.from(document.querySelectorAll("#bank rect.box")).slice(0,3);
  const coils = [$("#coil1"), $("#coil2"), $("#coil3")];

  const sumpWater = $("#sumpWater");
  const sumpSurface = $("#sumpSurface");

  const dots = {
    d120: $("#d120"),
    d130a: $("#d130a"), d130b: $("#d130b"), d130c: $("#d130c"),
    d140a: $("#d140a"), d140b: $("#d140b"), d140c: $("#d140c"),
    d150: $("#d150")
  };

  const tip = $("#tip");
  const tipTitle = $("#tipTitle");
  const tipDesc = $("#tipDesc");
  const tipMeta = $("#tipMeta");

  let step = 0;
  let playing = false;
  let timer = null;
  let raf = null;
  let t0 = 0;

  // STEP 7: “차오름” 타이밍 기준
  let stepChangedAtSec = 0;

  const allPipes = [p120,p130a,p130b,p130c,p140a,p140b,p140c,p150];

  const SUMP = { x:86, y:454, w:68, h:40, pad:3 };

  function initDimTargets(){
    const targets = $$("svg .box, svg .box2, svg .pipe, svg .node, svg .valve, svg .coil, svg text.label, svg text.sublabel");
    targets.forEach(el => el.classList.add("dimTarget"));
    $$(".frame").forEach(el => el.classList.remove("dimTarget"));
  }
  function clearFocus(){ $$(".dimTarget.focus", svg).forEach(el => el.classList.remove("focus")); }
  function focusByIds(ids){
    ids.forEach(id=>{
      const el = $("#"+id);
      if(el) el.classList.add("focus");
    });
  }
  function focusBySelectors(selectors){
    selectors.forEach(sel=>{
      $$(sel, svg).forEach(el => el.classList.add("focus"));
    });
  }

  function applyDimmingForStep(){
    clearFocus();
    if(step === 0){
      document.body.classList.remove("dimOn");
      return;
    }
    document.body.classList.add("dimOn");

    if(step === 1){
      focusByIds(["n31","n111","v115","p120","d120"]);
      focusBySelectors(["#tap *", "#header *"]);
    } else if(step === 2){
      focusByIds(["n111","v115","tankCold","p120","d120"]);
      focusBySelectors(["#header *", "#tap *"]);
    } else if(step === 3){
      focusByIds(["tankCold","n112a","n112b","n112c","p130a","p130b","p130c","d130a","d130b","d130c","hx1in"]);
      focusBySelectors(["#header *", "#ports112 *", "#bank *"]);
    } else if(step === 4){
      focusByIds(["p130a","p130b","p130c","p140a","p140b","p140c","d130a","d130b","d130c","d140a","d140b","d140c","coil1","coil2","coil3","hx1in","hx1out"]);
      focusBySelectors(["#bank *", "#ports112 *", "#ports114 *", "#header *"]);
    } else if(step === 5){
      focusByIds(["p140a","p140b","p140c","d140a","d140b","d140c","tankHot","n114a","n114b","n114c","hx1out"]);
      focusBySelectors(["#header *", "#ports114 *", "#bank *"]);
    } else if(step === 6){
      focusByIds(["p150","d150","n113","v116","n41in","sump41Body","sumpWater","sumpSurface","pump42"]);
      focusBySelectors(["#header *", "#pumpRoom *"]);
    }
  }

  function resetPipes(){
    allPipes.forEach(p=>{
      p.classList.remove("cold","hot","drain","dash");
      p.classList.add("pipe");
    });
    v115.style.stroke = "rgba(255,255,255,.18)";
    v116.style.stroke = "rgba(255,255,255,.18)";
  }

  function resetSumpWater(){
    if(!sumpWater || !sumpSurface) return;
    sumpWater.classList.remove("waterOn");
    sumpSurface.classList.remove("waterSurfaceOn");
    sumpWater.setAttribute("y", String(SUMP.y + SUMP.h));
    sumpWater.setAttribute("height", "0");
    sumpSurface.setAttribute("y1", String(SUMP.y + SUMP.h));
    sumpSurface.setAttribute("y2", String(SUMP.y + SUMP.h));
    sumpSurface.style.opacity = "";
  }

  function resetCoils(){ coils.forEach(c=>{ if(c) c.classList.remove("coilFlow"); }); }

  function resetEmphasis(){
    document.body.classList.remove("overview-lite");

    if(tankCold) tankCold.classList.remove("tank-cold-active","glow-cold","glow-hot","glow-drain");
    if(tankHot)  tankHot.classList.remove("tank-hot-active","glow-cold","glow-hot","glow-drain");

    ["n111","v115","n113","v116","n41in"].forEach(id=>{
      const el = $("#"+id);
      if(el) el.classList.remove("glow-cold","glow-hot","glow-drain");
    });
    ["n112a","n112b","n112c","n114a","n114b","n114c"].forEach(id=>{
      const el = $("#"+id);
      if(el) el.classList.remove("glow-cold","glow-hot","glow-drain");
    });

    hxBoxes.forEach(b=>b.classList.remove("hx-heat"));
    if(pump42) pump42.classList.remove("pump-run");

    resetCoils();
    resetSumpWater();
  }

  function setGate(open){
    gateState.classList.toggle("gateOn", open);
    if(open){
      gateState.setAttribute("x1","330"); gateState.setAttribute("y1","294");
      gateState.setAttribute("x2","330"); gateState.setAttribute("y2","314");
    }else{
      gateState.setAttribute("x1","316"); gateState.setAttribute("y1","296");
      gateState.setAttribute("x2","344"); gateState.setAttribute("y2","312");
    }
  }

  function applyFlow(f){
    resetPipes();
    resetEmphasis();

    svg.classList.remove("flowing");
    if(!f.on){
      stopAnim();
      setGate(false);
      if(step === 0) document.body.classList.add("overview-lite");
      return;
    }

    svg.classList.add("flowing");
    startAnim();

    if(f.cold){
      f.cold.forEach(id=>{ const p=$("#"+id); if(p) p.classList.add("cold","dash"); });
      v115.style.stroke = "rgba(99,179,255,.65)";
    }
    if(f.hot){
      f.hot.forEach(id=>{ const p=$("#"+id); if(p) p.classList.add("hot","dash"); });
    }
    if(f.drain){
      f.drain.forEach(id=>{ const p=$("#"+id); if(p) p.classList.add("drain","dash"); });
      v116.style.stroke = "rgba(110,231,183,.65)";
    }

    setGate(!!f.gateOpen);

    if(step === 1 || step === 2){
      const n111 = $("#n111");
      if(n111) n111.classList.add("glow-cold");
      if(v115) v115.classList.add("glow-cold");
    }
    if(step === 2 && tankCold){
      tankCold.classList.add("tank-cold-active","glow-cold");
    }
    if(step === 3){
      ["n112a","n112b","n112c"].forEach(id=>{ const el=$("#"+id); if(el) el.classList.add("glow-cold"); });
    }

    if(step === 4){
      hxBoxes.forEach(b=>b.classList.add("hx-heat"));
      coils.forEach(c=>{ if(c) c.classList.add("coilFlow"); });
    }

    if(step === 5){
      if(tankHot) tankHot.classList.add("tank-hot-active","glow-hot");
      ["n114a","n114b","n114c"].forEach(id=>{ const el=$("#"+id); if(el) el.classList.add("glow-hot"); });
    }

    if(step === 6){
      const n113 = $("#n113");
      const n41in = $("#n41in");
      if(n113) n113.classList.add("glow-drain");
      if(v116) v116.classList.add("glow-drain");
      if(n41in) n41in.classList.add("glow-drain");
      if(pump42) pump42.classList.add("pump-run");
      if(sumpWater && sumpSurface){
        sumpWater.classList.add("waterOn");
        sumpSurface.classList.add("waterSurfaceOn");
      }
    }
  }

  function startAnim(){ if(raf) return; t0=0; raf=requestAnimationFrame(animate); }
  function stopAnim(){ if(!raf) return; cancelAnimationFrame(raf); raf=null; }

  function easeOutCubic(x){ return 1 - Math.pow(1 - x, 3); }

  function animate(ts){
    if(!t0) t0 = ts;
    const t = (ts - t0)/1000;
    const sp = 1.1;

    dots.d120.setAttribute("cy", 150 + ((t*80*sp)%60));
    dots.d130a.setAttribute("cx", 450 + ((t*120*sp)%80));
    dots.d130b.setAttribute("cx", 460 + ((t*120*sp+20)%80));
    dots.d130c.setAttribute("cx", 470 + ((t*120*sp+40)%80));
    dots.d140a.setAttribute("cx", 860 - ((t*120*sp)%120));
    dots.d140b.setAttribute("cx", 860 - ((t*120*sp+25)%120));
    dots.d140c.setAttribute("cx", 860 - ((t*120*sp+50)%120));
    dots.d150.setAttribute("cx", 210 - ((t*70*sp)%50));

    // STEP 7: “차오르는 효과만” (가득 차면 유지)
    if(step === 6 && sumpWater && sumpSurface){
      const maxH = SUMP.h - SUMP.pad*2;
      const minH = 2;

      const elapsed = Math.max(0, t - stepChangedAtSec);
      const fillSeconds = 3.0;
      const k = Math.min(1, elapsed / fillSeconds);
      const level01 = 0.15 + 0.85 * easeOutCubic(k);

      const h = Math.max(minH, Math.min(maxH, level01 * maxH));
      const y = SUMP.y + SUMP.h - SUMP.pad - h;

      sumpWater.setAttribute("x", String(SUMP.x + SUMP.pad));
      sumpWater.setAttribute("width", String(SUMP.w - SUMP.pad*2));
      sumpWater.setAttribute("y", String(y));
      sumpWater.setAttribute("height", String(h));

      const surfY = y;
      sumpSurface.setAttribute("x1", String(SUMP.x + SUMP.pad + 2));
      sumpSurface.setAttribute("x2", String(SUMP.x + SUMP.w - SUMP.pad - 2));
      sumpSurface.setAttribute("y1", String(surfY));
      sumpSurface.setAttribute("y2", String(surfY));

      const shimmer = 0.78 + 0.22 * Math.abs(Math.sin(t*2.2));
      sumpSurface.style.opacity = String(shimmer);
    }

    raf = requestAnimationFrame(animate);
  }

  function renderMiniList(){
    miniList.innerHTML = "";
    steps.forEach((s, i)=>{
      const li = document.createElement("li");
      li.className = "miniItem" + (i===step ? " active" : "");
      li.setAttribute("role","button");
      li.setAttribute("tabindex","0");
      li.innerHTML = `
        <div class="miniNum">${i+1}</div>
        <div class="miniTxt">
          <strong>${s.title.replace(/^STEP \\d+\\.\\s?/,'')}</strong>
          <span>${s.one}</span>
        </div>
      `;
      li.addEventListener("click", ()=>{ step=i; setPlaying(false); markStepChange(); render(); });
      li.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); li.click(); } });
      miniList.appendChild(li);
    });
  }

  function markStepChange(){
    if(!t0){ stepChangedAtSec = 0; return; }
    const now = performance.now();
    stepChangedAtSec = (now - t0)/1000;
  }

  function render(){
    const s = steps[step];
    stepPill.textContent = `STEP ${step+1} / ${steps.length}`;
    modePill.textContent = playing ? "재생 중" : "정지";
    bar.style.width = `${Math.round(((step+1)/steps.length)*100)}%`;

    stTitle.textContent = s.title;
    stOne.textContent = s.one;
    stNow.innerHTML = s.now;

    prevBtn.disabled = (step===0);
    nextBtn.disabled = (step===steps.length-1);

    applyFlow(s.flow);
    applyDimmingForStep();
    renderMiniList();
  }

  function setPlaying(on){
    playing = on;
    modePill.textContent = playing ? "재생 중" : "정지";
    playBtn.textContent = playing ? "일시정지" : "자동재생";
    if(playing){
      timer = setInterval(()=>{
        if(step < steps.length-1){
          step++;
          markStepChange();
          render();
        } else {
          setPlaying(false);
        }
      }, 2600);
    } else {
      clearInterval(timer); timer=null;
    }
  }

  prevBtn.addEventListener("click", ()=>{ if(step>0){ step--; setPlaying(false); markStepChange(); render(); } });
  nextBtn.addEventListener("click", ()=>{ if(step<steps.length-1){ step++; setPlaying(false); markStepChange(); render(); } });
  playBtn.addEventListener("click", ()=> setPlaying(!playing));
  resetBtn.addEventListener("click", ()=>{ setPlaying(false); step=0; markStepChange(); render(); });

  function showTip(x,y,title,desc,metaCsv){
    tipTitle.textContent = title || "구성요소";
    tipDesc.textContent = desc || "";
    tipMeta.innerHTML = "";
    (metaCsv||"").split(",").map(s=>s.trim()).filter(Boolean).forEach(m=>{
      const span = document.createElement("span");
      span.className="chip";
      span.textContent=m;
      tipMeta.appendChild(span);
    });

    tip.style.display="block";

    // v6.2: 모바일에서는 bottom-sheet 고정(좌표 계산 생략)
    const isMobile = window.matchMedia("(max-width: 820px)").matches;
    if(isMobile) return;

    const pad=14;
    const rect=tip.getBoundingClientRect();
    let left=x+12, top=y+12;
    if(left+rect.width+pad>window.innerWidth) left=x-rect.width-12;
    if(top+rect.height+pad>window.innerHeight) top=y-rect.height-12;
    tip.style.left=`${Math.max(pad,left)}px`;
    tip.style.top =`${Math.max(pad,top)}px`;
  }
  function hideTip(){ tip.style.display="none"; }

  svg.addEventListener("click",(e)=>{
    const t = e.target.closest(".hotspot");
    if(!t){ hideTip(); return; }
    showTip(e.clientX,e.clientY, t.getAttribute("data-tip"), t.getAttribute("data-desc"), t.getAttribute("data-meta"));
  });

  window.addEventListener("click",(e)=>{
    if(e.target.closest("#tip")) return;
    if(e.target.closest("svg .hotspot")) return;
    hideTip();
  });

  window.addEventListener("keydown",(e)=>{
    if(e.key==="Escape") hideTip();
    if(e.key==="ArrowLeft"){ e.preventDefault(); prevBtn.click(); }
    if(e.key==="ArrowRight"){ e.preventDefault(); nextBtn.click(); }
    if(e.key===" "){ e.preventDefault(); playBtn.click(); }
// ===== v6.2.1: 모바일 스와이프(좌/우)로 STEP 이동 =====
  // - 좌 스와이프: 다음 STEP
  // - 우 스와이프: 이전 STEP
  // - 스크롤(세로) 의도는 방해하지 않음
  (() => {
    const isMobile = () => window.matchMedia("(max-width: 820px)").matches;

    let sx = 0, sy = 0, st = 0;
    let tracking = false;

    // 민감도(필요시 조절)
    const MIN_X = 45;     // 좌우 이동 최소 픽셀
    const MAX_Y = 60;     // 세로 움직임이 이보다 크면 스와이프 취소(스크롤 우선)
    const MAX_MS = 700;   // 너무 느린 제스처는 무시(스크롤/드래그 오인 방지)

    // 스와이프 대상 영역: SVG + 좌측 카드 본문
    // (우측 리스트에서 스크롤/탭을 방해하지 않도록 제한)
    const swipeZone = document.querySelector("section.card .bd");

    if(!swipeZone) return;

    swipeZone.addEventListener("touchstart", (e) => {
      if(!isMobile()) return;
      if(!e.touches || e.touches.length !== 1) return;

      const t = e.touches[0];
      sx = t.clientX;
      sy = t.clientY;
      st = performance.now();
      tracking = true;
    }, {passive:true});

    swipeZone.addEventListener("touchmove", (e) => {
      if(!tracking) return;
      if(!e.touches || e.touches.length !== 1) return;

      const t = e.touches[0];
      const dx = t.clientX - sx;
      const dy = t.clientY - sy;

      // 세로 스크롤 의도가 강하면 스와이프 추적 종료
      if(Math.abs(dy) > MAX_Y && Math.abs(dy) > Math.abs(dx)){
        tracking = false;
      }
    }, {passive:true});

    swipeZone.addEventListener("touchend", (e) => {
      if(!tracking) return;
      tracking = false;

      const dt = performance.now() - st;
      if(dt > MAX_MS) return;

      const t = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
      if(!t) return;

      const dx = t.clientX - sx;
      const dy = t.clientY - sy;

      // 세로 이동이 크면 무시(스크롤 우선)
      if(Math.abs(dy) > MAX_Y) return;

      // 좌우 이동이 충분할 때만 인정
      if(Math.abs(dx) < MIN_X) return;

      // 툴팁(하단 시트)이 열려 있으면 스와이프로 단계가 바뀌지 않게(혼선 방지)
      if(tip && tip.style.display === "block") return;

      // 좌 스와이프 = 다음, 우 스와이프 = 이전
      if(dx < 0){
        if(step < steps.length - 1){
          step++;
          setPlaying(false);
          markStepChange();
          render();
        }
      } else {
        if(step > 0){
          step--;
          setPlaying(false);
          markStepChange();
          render();
        }
      }
    }, {passive:true});
  })();
  });

  initDimTargets();
  markStepChange();
  render();
})();
</script>
</body>
</html>
